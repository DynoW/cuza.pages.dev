---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Încarcă PDF by @Danutz" nofollow noindex bodyClass="mx-4">
    <div class="max-w-lg mx-auto bg-white p-6 rounded-lg shadow-lg absolute top-1/3 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
        <h1 class="text-center text-gray-800">
            Încarcă documentul PDF pentru <a href="https://cuza.pages.dev" class="text-blue-500">cuza.pages.dev</a> - <a href="https://github.com/DynoW" class="text-blue-500">DynoW</a>
        </h1>
        <form id="uploadForm" method="POST" enctype="multipart/form-data" class="flex flex-col gap-4 mt-4">
            <label for="year" class="font-bold">An:</label>
            <input type="number" id="year" name="year" required class="p-2 border border-gray-300 rounded" />

            <label for="type1" class="font-bold">Tip 1:</label>
            <select id="type1" name="type1" required class="p-2 border border-gray-300 rounded">
                <option value="model">Model</option>
                <option value="simulare">Simulare</option>
                <option value="01">01</option>
                <option value="02">02</option>
                <option value="03">03</option>
                <option value="04">04</option>
                <option value="05">05</option>
                <option value="06">06</option>
                <option value="07">07</option>
                <option value="08">08</option>
                <option value="09">09</option>
                <option value="10">10</option>
            </select>

            <label for="type2" class="font-bold">Tip 2:</label>
            <select id="type2" name="type2" required class="p-2 border border-gray-300 rounded">
                <option value="var">Var</option>
                <option value="bar">Bar</option>
            </select>

            <label for="file" class="font-bold">Selectează PDF:</label>
            <input type="file" id="file" name="file" accept="application/pdf" required class="p-2 border border-gray-300 rounded" />

            <button type="submit" class="bg-blue-500 text-white p-2 rounded mt-4 cursor-pointer hover:bg-blue-600">Încarcă</button>
        </form>
        <div id="message" class="mt-4 text-center"></div>
    </div>

    <!-- The Modal -->
    <div id="passwordModal" class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="modal-content bg-white p-6 rounded-lg shadow-lg w-80">
            <div class="modal-content-heading flex justify-between items-center">
                <label for="passwordInput" class="passwordInputText font-bold">Introdu parola</label>
                <span class="close cursor-pointer text-gray-500 text-2xl font-bold">&times;</span>
            </div>
            <input type="password" id="passwordInput" class="p-2 border border-gray-300 rounded mt-4" />
            <button id="submitPassword" class="bg-blue-500 text-white p-2 rounded mt-4 cursor-pointer hover:bg-blue-600">Trimite</button>
        </div>
    </div>

    <script>
        const form = document.getElementById("uploadForm") as HTMLFormElement;
        const messageDiv = document.getElementById("message");
        const modal = document.getElementById("passwordModal");
        const closeModal = document.getElementsByClassName("close")[0];
        const submitPasswordBtn = document.getElementById("submitPassword");

        let password = "";

        if (form && messageDiv && modal && closeModal && submitPasswordBtn) {
            form.addEventListener("submit", async (event) => {
                event.preventDefault();
                modal.classList.remove("hidden");
            });

            (closeModal as HTMLElement).onclick = function () {
                modal.classList.add("hidden");
            };

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.classList.add("hidden");
                }
            };

            submitPasswordBtn.onclick = async function () {
                const passwordInput = document.getElementById("passwordInput");
                if (passwordInput) {
                    password = (passwordInput as HTMLInputElement).value;
                }
                modal.classList.add("hidden");

                messageDiv.textContent = "Se încarcă...";
                messageDiv.className = "text-blue-500";

                const formData = new FormData(form);
                const username = "admin";
                const authHeader = "Basic " + btoa(`${username}:${password}`);

                try {
                    const response = await fetch(
                        "https://cuza-worker.danutz.workers.dev",
                        {
                            method: "POST",
                            headers: {
                                Authorization: authHeader,
                            },
                            body: formData,
                        },
                    );

                    if (response.ok) {
                        messageDiv.textContent = "Fișierul a fost încărcat cu succes!";
                        messageDiv.className = "text-green-500";
                    } else {
                        const result = await response.text();
                        messageDiv.textContent = `Eroare: ${result}`;
                        messageDiv.className = "text-red-500";
                    }
                } catch (error) {
                    messageDiv.textContent = "A apărut o eroare în timpul încărcării.";
                    messageDiv.className = "text-red-500";
                }
            };
        }
    </script>
</Layout>