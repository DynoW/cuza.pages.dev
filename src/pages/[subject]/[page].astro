---
import PageComponent from "../../components/Page.astro";
import fs from "fs";
import path from "path";

export function getStaticPaths() {
  // Get the absolute path to the files directory
  const filesPath = path.join(process.cwd(), "files");

  // Read directories in the files path to get subjects
  const validSubjects = fs
    .readdirSync(filesPath)
    .filter((file) => fs.statSync(path.join(filesPath, file)).isDirectory());

  const paths: { params: { subject: string; page: string } }[] = [];

  // For each subject, get its valid pages from subdirectories
  validSubjects.forEach((subject) => {
    let subjectPath;

    if (subject === "admitere") {
      subjectPath = path.join(filesPath, subject);
    } else {
      subjectPath = path.join(filesPath, `${subject}/pages`);
    }

    // Read subdirectories to get valid pages
    let validPages;

    validPages = fs
      .readdirSync(subjectPath)
      .filter(
        (file) =>
          fs.statSync(path.join(subjectPath, file)).isDirectory() &&
          file !== "bac"
      );

    validPages.forEach((page) => {
      paths.push({ params: { subject, page } });
    });
  });
  
  return paths;
}

// Get the dynamic route parameters
const { subject, page } = Astro.params;
---

<PageComponent subject={subject} page={page} />
