---
// Add props to customize shortcuts for each page
interface Props {
  subject: string;
  page: string;
}

import { apiService } from '../utils/api';

const { subject, page } = Astro.props;

// Fetch years from the API using the efficient years-only endpoint
let availableYears: number[] = [];
let apiError: string | null = null;

try {
  availableYears = await apiService.getYears(subject, page);
} catch (error) {
  apiError = `Failed to fetch years: ${error instanceof Error ? error.message : String(error)}`;
  console.warn("API fetch failed for shortcuts:", error);
}

// Function to determine the URL for a year shortcut
function getShortcutUrl(year: number) {
  // Special case: if subject is fizica, page is bac, and year is 2007, link to /fizica/variante
  // if (subject === 'fizica' && (page === 'bac' || !page) && year === 2007) {
  //   return '/fizica/variante';
  // }
  
  // Default behavior: link to anchor tag for the year
  return `#${year}`;
}
---

<div class="shortcuts-container">
  <span class="text-lg font-bold text-white mb-2">Accesare rapidă</span>
  
  {
    apiError && (
      <div class="text-xs text-red-400 mb-2">
        Nu s-au putut încărca scurtăturile
      </div>
    )
  }
  
  {
    availableYears.length > 0 ? (
      <div class="shortcuts-grid">
        {availableYears.map((year) => (
          <a 
            href={getShortcutUrl(year)}
            class="shortcut-button"
            title={`Salt la documentele din ${year}`}
          >
            {year}
          </a>
        ))}
      </div>
    ) : (
      !apiError && (
        <p class="text-slate-400">
          Niciun an disponibil
        </p>
      )
    )
  }
</div>

<style>
  .shortcuts-container {
    margin-bottom: 1.5rem;
  }

  .shortcuts-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .shortcut-button {
    background-color: #1e293b;
    color: #94a3b8;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    text-align: center;
    min-width: 3rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .shortcut-button:hover {
    background-color: #334155;
    color: #e2e8f0;
    transform: translateY(-1px);
  }
</style>