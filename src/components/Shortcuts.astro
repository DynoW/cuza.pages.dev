---
import { apiService } from '../api';

interface Props {
  subject: string;
  page: string;
  /** Pre-fetched years – skips an API call when provided. */
  years?: number[];
}

const { subject, page, years: propYears } = Astro.props;

let availableYears: number[] = [];
let apiError: string | null = null;

if (propYears !== undefined) {
  availableYears = propYears;
} else {
  try {
    availableYears = await apiService.getYears(subject, page);
  } catch (error) {
    apiError = `Failed to fetch years: ${error instanceof Error ? error.message : String(error)}`;
    console.warn("API fetch failed for shortcuts:", error);
  }
}
---

<div class="shortcuts-container">
  <p class="text-lg font-bold text-white">Accesare rapidă</p>
  
  {
    apiError && (
      <div class="text-xs text-red-500 mb-2">
        Nu s-au putut încărca scurtăturile
      </div>
    )
  }
  
  {
    availableYears.length > 0 ? (
      <div class="shortcuts-grid">
        {availableYears.map((year) => (
          <a 
            href={`#${year}`}
            class="shortcut-button"
            title={`Salt la documentele din ${year}`}
          >
            {year}
          </a>
        ))}
      </div>
    ) : (
      !apiError && (
        <p class="text-slate-400">
          Niciun an disponibil
        </p>
      )
    )
  }
</div>

<style>
  .shortcuts-container {
    margin-bottom: 1rem;
  }

  .shortcuts-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .shortcut-button {
    background-color: #1e293b;
    color: #94a3b8;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    text-align: center;
    min-width: 3rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .shortcut-button:hover {
    background-color: #334155;
    color: #e2e8f0;
    transform: translateY(-1px);
  }
</style>