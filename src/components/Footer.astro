---
var users: any[] = [];

async function fetchData() {
    if (import.meta.env.PROD === true) {
        try {
            const response = await fetch(
                "https://api.github.com/repos/DynoW/cuza.pages.dev/contributors",
                {
                    method: "GET",
                    headers: {
                        Authorization: import.meta.env.TOKEN_GITHUB,
                    },
                },
            );

            if (response.ok) {
                users = await response.json();
            } else {
                console.error("Failed to fetch contributors.");
            }
        } catch (error) {
            console.error("Error fetching contributors:", error);
        }
    }

    const contributorAlias: Record<string, string | null | undefined> = {
        Naffets0: "",
        DynoW: "",
    };
    const contributors: Record<string, any | null> = {};

    // Define a function to populate contributors
    async function populateContributors() {
        for (const user of users) {
            const username = user.login;
            const alias = contributorAlias[username];
            if (alias == undefined) {
                contributors[username] = await getSocials(username);
            } else if (alias != "") {
                contributors[alias] = await getSocials(username);
            }
        }
    }

    // Call the function to populate contributors
    await populateContributors();

    return contributors;
}

async function getSocials(name: string) {
    if (import.meta.env.PROD === true) {
        try {
            const response = await fetch(
                `https://api.github.com/users/${name}/social_accounts`,
                {
                    method: "GET",
                    headers: {
                        Authorization: import.meta.env.TOKEN_GITHUB,
                    },
                },
            );

            if (response.ok) {
                const data = await response.json();
                for (const provider of data) {
                    if (provider.provider === "instagram") {
                        return provider.url;
                    }
                }
            } else {
                console.error("Failed to fetch contributors.");
            }
        } catch (error) {
            console.error(`Error fetching social accounts for ${name}:`, error);
        }
    }
    return "#";
}

const dict = await fetchData();
---

<footer class="mt-3 bg-gray-300/75 text-slate-500">
    <div class="container py-4 lg:py-3 mx-auto">
        <div class="text-muted flex justify-between items-center pt-3">
            <div class="row">
                <div class="col">
                    <p class="mb-0">Copyright Â© 2023 DynoW</p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="row">
                        <div class="text-slate-600 col">
                            <a
                                class="hover:text-slate-800"
                                href="https://github.com/DynoW"
                                target="_blank">Danutz</a
                            >
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>-Developer</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="text-slate-600 col">
                            <a
                                class="hover:text-slate-800"
                                href="https://e-z.bio/zeniru"
                                target="_blank">Costi</a
                            >
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>-Designer</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="text-slate-600 col">
                            <a
                                class="hover:text-slate-800"
                                href="https://www.instagram.com/extrem5pro/"
                                target="_blank">Tudor</a
                            >
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>-Documents Manager</p>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="text-slate-600 col">
                            <a
                                class="hover:text-slate-800"
                                href="
                                https://www.instagram.com/ro_alex69"
                                target="_blank">Belu</a
                            >
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>-Banner Manager</p>
                        </div>
                    </div>
                </div>
                <div class="col mt-5 md:mt-0">
                    <div class="row">
                        <p>Contribuitors:</p>
                    </div>
                    <div class="row">
                        <div class="text-slate-600 col">
                            <div class="flex flex-row flex-wrap">
                            {
                                Object.entries(dict).map(([key, value]) =>
                                    key != Object.keys(dict).pop() ? (
                                        <a
                                            class="hover:text-slate-800"
                                            href={value}
                                            target="_blank">
                                            {key},&nbsp;
                                        </a>
                                    ) : (
                                        <a
                                            class="hover:text-slate-800"
                                            href={value}
                                            target="_blank">
                                            {key}
                                        </a>
                                    ),
                                )
                            }</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row sm:rotate-0 rotate-90">
                <div class="col">
                    <p class="">cuza.pages.dev @ gmail.com</p>
                </div>
            </div>
        </div>
    </div>
</footer>
